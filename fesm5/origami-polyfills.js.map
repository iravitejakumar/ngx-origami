{"version":3,"file":"origami-polyfills.js","sources":["ng://@codebakery/origami/polyfills/src/webcomponents-ready.ts","ng://@codebakery/origami/polyfills/src/shim-custom-elements.ts","ng://@codebakery/origami/polyfills/src/shim-html-element-class.ts","ng://@codebakery/origami/polyfills/src/webcomponents-ready.module.ts","ng://@codebakery/origami/polyfills/origami-polyfills.ts"],"sourcesContent":["import { whenSet } from '@codebakery/origami/util';\n\ndeclare global {\n  interface Window {\n    WebComponents: {\n      ready: boolean;\n    };\n  }\n}\n\nlet readyPromise: Promise<void> | undefined;\n/**\n * Returns a Promise that resolves when webcomponent polyfills are ready. If\n * this function is used *without* polyfills loaded, it will never resolve.\n *\n * @returns a Promise that resolves when webcomponents are ready\n */\nexport function webcomponentsReady(): Promise<void> {\n  if (!readyPromise) {\n    readyPromise = new Promise(resolve => {\n      whenSet(window, 'WebComponents', undefined, WebComponents => {\n        if (WebComponents && !WebComponents.ready) {\n          document.addEventListener('WebComponentsReady', function onready() {\n            document.removeEventListener('WebComponentsReady', onready);\n            resolve();\n          });\n        } else {\n          resolve();\n        }\n      });\n    });\n  }\n\n  return readyPromise;\n}\n\n/**\n * Resets the `webcomponentsReady()` function. Should only be used in testing.\n */\nexport function resetWebcomponentsReady() {\n  readyPromise = undefined;\n}\n","import { webcomponentsReady } from './webcomponents-ready';\n\ndeclare global {\n  interface Window {\n    CustomElementRegistry: {\n      new (): CustomElementRegistry;\n      prototype: CustomElementRegistry;\n    };\n  }\n}\n\n/**\n * Shims `window.customElements` with a placeholder that allows custom elements\n * to define themselves before the WebComponents polyfill is ready. When the\n * polyfill loads, the element definitions will be defined with the polyfilled\n * `customElements`.\n *\n * This allows the developer to import files that call `customElements.define()`\n * without having to delay loading the app via `webcomponentsReady()`.\n *\n * This is automatically called by Origami.\n */\nexport function shimCustomElements() {\n  if (!window.customElements) {\n    const ceMap: {\n      [name: string]: [\n        new () => HTMLElement,\n        ElementDefinitionOptions | undefined\n      ];\n    } = {};\n\n    const ceWhenDefined: {\n      [name: string]: [Promise<void>, Function];\n    } = {};\n\n    const ceUpgrade: Node[] = [];\n\n    class CustomElementRegistryShim {\n      // instruct webcomponentsjs to ignore this shim\n      forcePolyfill = true;\n\n      get(name: string): any {\n        return ceMap[name] && ceMap[name][0];\n      }\n\n      define(\n        name: string,\n        constructor: new () => HTMLElement,\n        options?: ElementDefinitionOptions\n      ) {\n        ceMap[name] = [constructor, options];\n      }\n\n      whenDefined(name: string): Promise<void> {\n        if (!Array.isArray(ceWhenDefined[name])) {\n          ceWhenDefined[name] = <any>[];\n          ceWhenDefined[name][0] = new Promise(resolve => {\n            ceWhenDefined[name][1] = resolve;\n          });\n        }\n\n        return ceWhenDefined[name][0];\n      }\n\n      upgrade(root: Node) {\n        ceUpgrade.push(root);\n      }\n    }\n\n    window.customElements = new CustomElementRegistryShim();\n    window.CustomElementRegistry = CustomElementRegistryShim;\n\n    webcomponentsReady().then(() => {\n      Object.keys(ceWhenDefined).forEach(name => {\n        window.customElements.whenDefined(name).then(() => {\n          ceWhenDefined[name][1]();\n        });\n      });\n\n      Object.keys(ceMap).forEach(name => {\n        const [constructor, options] = ceMap[name];\n        window.customElements.define(name, constructor, options);\n      });\n\n      ceUpgrade.forEach(root => window.customElements.upgrade(root));\n    });\n  }\n}\n","declare global {\n  interface Window {\n    HTMLElement: typeof HTMLElement;\n  }\n}\n\n/**\n * Fixes issues where HTMLElement is an object and not a function in browsers,\n * which causes extending them using Typescript's `__extend` to break.\n *\n * See https://github.com/webcomponents/custom-elements/issues/109\n */\nexport function shimHtmlElementClass() {\n  if (typeof HTMLElement === 'object') {\n    const HTMLElementFn = function() {};\n    HTMLElementFn.prototype = (<any>HTMLElement).prototype;\n    window.HTMLElement = <typeof HTMLElement>HTMLElementFn;\n  }\n}\n","import { APP_INITIALIZER, NgModule, Provider } from '@angular/core';\nimport { shimCustomElements } from './shim-custom-elements';\nimport { shimHtmlElementClass } from './shim-html-element-class';\nimport { webcomponentsReady } from './webcomponents-ready';\n\nshimCustomElements();\nshimHtmlElementClass();\n\nexport const WEBCOMPONENTS_READY_PROVIDER: Provider = {\n  provide: APP_INITIALIZER,\n  multi: true,\n  useValue: webcomponentsReady\n};\n\n@NgModule({\n  providers: [WEBCOMPONENTS_READY_PROVIDER]\n})\nexport class WebComponentsReadyModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}